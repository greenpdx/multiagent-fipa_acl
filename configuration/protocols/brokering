<scxml version="1.0" initial="1">

        <!-- This means: Any subprotocol (inform/query/...) can be started.
             Actually it will be the proxied performative. Subprotocols are all started by 'B'. The response is 'proxied',
             i.e. forwarded back to the initiator. That means, that either 0 (in case of inform)
             or 1 (otherwise) messages are sent back, not more!
             For propagate subprotocols, proxied_to should be omitted.
        -->
        <subprotocol name=".*" from="B" proxied_to="initiator" start_state="4"/> 
    
	<state id="1">
	        <transition performative="proxy" from="initiator" to="B" target="2"/>
	</state>
	<state id="2">
		<transition performative="refuse" from="B" to="initiator" target="3"/>
		<transition performative="agree" from="B" to="initiator" target="4"/>
	</state>
	
	<state id="3" final="yes">
	</state>
	
	<state id="4">
                <!-- This is failure no-match (no subprotocol started) or failure-proxy (sent after refuse message in subprotocol received) -->
		<transition performative="failure" from="B" to="initiator" target="5"/>
		
		<!-- This is inform done-proxy (sent after agree message in subprotocol received) -->
		<transition performative="inform" from="B" to="initiator" target="6"/>
	</state>
	
	<state id="5" final="yes">
	</state>
	
	<!-- Default transitions for this final state are only added, as it has a transition.
             Other protocols using embedded statemachines must add one transition to final
             states for which they want default transitions (for that sender/receiver pair)
             to be added.
        -->
	<state id="6" final="yes">
                <!-- This is failure-brokering (sent after failure message in subprotocol received) -->
                <transition performative="failure" from="B" to="initiator" target="7"/>
	</state>
	
	<state id="7" final="yes">
        </state>
</scxml>
